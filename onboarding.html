<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Philantrac Onboarding</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://connect-js.stripe.com/v1.0/connect.js" async></script>
    <style>
      body {
        font-family: sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 30px;
      }

      #container {
        max-width: 600px;
        margin: auto;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }

      #loading {
        text-align: center;
        font-size: 18px;
        padding: 40px;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <div id="loading">Loading onboarding form...</div>
    </div>

    <script>
      window.StripeConnect = window.StripeConnect || {};

      StripeConnect.onLoad = async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const clientSecret = urlParams.get("secret");
        const publishableKey = "pk_test_51QpxmvLuSJ6SZh9b6mW4vZTkGaMvBLzJvZUGcm9w8AjsjWb6eppnxguqxn8foeziwTpz0DdzOnnFWo6rRJ396HWR00HLjnhIQO"; // ðŸ”‘ Replace this

        if (!clientSecret) {
          document.getElementById("loading").innerText = "Missing client secret.";
          return;
        }

        try {
          const stripeConnectInstance = StripeConnect.init({
            publishableKey: publishableKey,
            fetchClientSecret: () => Promise.resolve(clientSecret),
          });

          const onboarding = stripeConnectInstance.create("account-onboarding");

          onboarding.setOnExit(() => {
            console.log("User exited onboarding");
          });

          onboarding.setOnStepChange((e) => {
            console.log("User moved to step:", e.step);
          });

          const container = document.getElementById("container");
          container.innerHTML = ""; // Remove loading text
          container.appendChild(onboarding);
        } catch (error) {
          console.error("Error mounting onboarding:", error);
          document.getElementById("loading").innerText = "Failed to load onboarding form.";
        }
      };
    </script>
  </body>
</html>
